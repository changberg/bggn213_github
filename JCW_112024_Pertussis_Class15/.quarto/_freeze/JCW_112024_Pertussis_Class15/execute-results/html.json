{
  "hash": "2a962d4abb1afdb3d06653dce4d508ed",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Investigating Pertussis Resurgence, Class 15\"\nauthor: \"Janie Chang-Weinberg (A69037446)\"\nformat: html\n---\n\n\n\nPertussis, aka \"whooping cough\" is a highly contagious lung infection caused by the *B. Pertussis* bacteria.\n\nThe CDC tracks Pertussis case numbers and they can be accessed [here](https://www.cdc.gov/pertussis/php/surveillance/pertussis-cases-by-year.html?CDC_AAref_Val=https://www.cdc.gov/pertussis/surv-reporting/cases-by-year.html)\n\n\nWe need to \"scrape\" this data so we do stuff with it in R. Let's try the **datapasta** package to do this.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncdc <- data.frame(\n                                 Year = c(1922L,1923L,1924L,1925L,\n                                          1926L,1927L,1928L,1929L,1930L,1931L,\n                                          1932L,1933L,1934L,1935L,1936L,\n                                          1937L,1938L,1939L,1940L,1941L,1942L,\n                                          1943L,1944L,1945L,1946L,1947L,\n                                          1948L,1949L,1950L,1951L,1952L,\n                                          1953L,1954L,1955L,1956L,1957L,1958L,\n                                          1959L,1960L,1961L,1962L,1963L,\n                                          1964L,1965L,1966L,1967L,1968L,1969L,\n                                          1970L,1971L,1972L,1973L,1974L,\n                                          1975L,1976L,1977L,1978L,1979L,1980L,\n                                          1981L,1982L,1983L,1984L,1985L,\n                                          1986L,1987L,1988L,1989L,1990L,\n                                          1991L,1992L,1993L,1994L,1995L,1996L,\n                                          1997L,1998L,1999L,2000L,2001L,\n                                          2002L,2003L,2004L,2005L,2006L,2007L,\n                                          2008L,2009L,2010L,2011L,2012L,\n                                          2013L,2014L,2015L,2016L,2017L,2018L,\n                                          2019L,2020L,2021L,2022L,2024L),\n         Cases = c(107473,164191,165418,152003,\n                                          202210,181411,161799,197371,\n                                          166914,172559,215343,179135,265269,\n                                          180518,147237,214652,227319,103188,\n                                          183866,222202,191383,191890,109873,\n                                          133792,109860,156517,74715,69479,\n                                          120718,68687,45030,37129,60886,\n                                          62786,31732,28295,32148,40005,\n                                          14809,11468,17749,17135,13005,6799,\n                                          7717,9718,4810,3285,4249,3036,\n                                          3287,1759,2402,1738,1010,2177,2063,\n                                          1623,1730,1248,1895,2463,2276,\n                                          3589,4195,2823,3450,4157,4570,\n                                          2719,4083,6586,4617,5137,7796,6564,\n                                          7405,7298,7867,7580,9771,11647,\n                                          25827,25616,15632,10454,13278,\n                                          16858,27550,18719,48277,28639,32971,\n                                          20762,17972,18975,15609,18617,\n                                          6124,2116,3044, 23544)\n       )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\nbaseplot <- ggplot(cdc, aes(Year, Cases)) +\n  geom_point() + \n  geom_line()\n\nbaseplot\n```\n\n::: {.cell-output-display}\n![](JCW_112024_Pertussis_Class15_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\nLet's add the date of the wP vaccination introduction.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbaseplot +\n  theme_bw() +\n  geom_vline(xintercept = 1946, color = \"blue\")\n```\n\n::: {.cell-output-display}\n![](JCW_112024_Pertussis_Class15_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nLet's add the date of the switch to the new aP vaccine.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbaseplot +\n  theme_bw() +\n  geom_vline(xintercept = 1946, color = \"blue\") +\n  geom_vline(xintercept = 1996, color = \"maroon\")\n```\n\n::: {.cell-output-display}\n![](JCW_112024_Pertussis_Class15_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\nlet's add in COVID\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbaseplot +\n  theme_bw() +\n  geom_vline(xintercept = 1946, color = \"blue\") +\n  geom_vline(xintercept = 1996, color = \"maroon\") +\n  geom_vline(xintercept = 2020, color = \"green\")\n```\n\n::: {.cell-output-display}\n![](JCW_112024_Pertussis_Class15_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\nThere was a pertussis outbreak in Disneyland or something\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbaseplot +\n  theme_bw() +\n  geom_vline(xintercept = 1946, color = \"blue\") +\n  geom_vline(xintercept = 1996, color = \"maroon\") +\n  geom_vline(xintercept = 2020, color = \"green\") +\n  geom_vline(xintercept = 2003, color = \"orange\")\n```\n\n::: {.cell-output-display}\n![](JCW_112024_Pertussis_Class15_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n## CMI-PB (Computational Models of Immunity - Pertussis Boost)\n\nThis project collects and makes freely available data about the immune response to Pertussis vaccination.\n\nYou can access the data via an API which returns JSON format (key:value pairs).\n\nWe can use the **jsonlite** package and it's `read_json()` function.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(jsonlite)\n\nsubject <- read_json(\"http://cmi-pb.org/api/v5/subject\",\n                     simplifyVector = TRUE)\n\n# let's take a gander\nhead(subject)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  subject_id infancy_vac biological_sex              ethnicity  race\n1          1          wP         Female Not Hispanic or Latino White\n2          2          wP         Female Not Hispanic or Latino White\n3          3          wP         Female                Unknown White\n4          4          wP           Male Not Hispanic or Latino Asian\n5          5          wP           Male Not Hispanic or Latino Asian\n6          6          wP         Female Not Hispanic or Latino White\n  year_of_birth date_of_boost      dataset\n1    1986-01-01    2016-09-12 2020_dataset\n2    1968-01-01    2019-01-28 2020_dataset\n3    1983-01-01    2016-10-10 2020_dataset\n4    1988-01-01    2016-08-29 2020_dataset\n5    1991-01-01    2016-08-29 2020_dataset\n6    1988-01-01    2016-10-10 2020_dataset\n```\n\n\n:::\n:::\n\n\n\n### How many subjects do we have?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnrow(subject)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 172\n```\n\n\n:::\n:::\n\n\n> there are 172 subjects here.\n\n### How many male/female do we have?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(subject$biological_sex)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFemale   Male \n   112     60 \n```\n\n\n:::\n:::\n\n\n> There are 112 females and 60 males\n\n### How many wP and aP do we have?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(subject$infancy_vac)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\naP wP \n87 85 \n```\n\n\n:::\n:::\n\n\n> There are 85 wP and 87 aP.\n\n### Breakdown of biological sex and race?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(subject$race, subject$biological_sex)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                           \n                                            Female Male\n  American Indian/Alaska Native                  0    1\n  Asian                                         32   12\n  Black or African American                      2    3\n  More Than One Race                            15    4\n  Native Hawaiian or Other Pacific Islander      1    1\n  Unknown or Not Reported                       14    7\n  White                                         48   32\n```\n\n\n:::\n:::\n\n\n\n### Does this breakdown reflect the US population?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(subject$dataset)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n2020_dataset 2021_dataset 2022_dataset 2023_dataset \n          60           36           22           54 \n```\n\n\n:::\n:::\n\n\n\n\n> NO!\n\nThese data are still useful, however. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspecimen <- read_json(\"http://cmi-pb.org/api/v5/specimen\", \n                      simplifyVector = TRUE)\n\nab_titer <- read_json(\"http://cmi-pb.org/api/v5/plasma_ab_titer\",\n                      simplifyVector = TRUE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(specimen)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  specimen_id subject_id actual_day_relative_to_boost\n1           1          1                           -3\n2           2          1                            1\n3           3          1                            3\n4           4          1                            7\n5           5          1                           11\n6           6          1                           32\n  planned_day_relative_to_boost specimen_type visit\n1                             0         Blood     1\n2                             1         Blood     2\n3                             3         Blood     3\n4                             7         Blood     4\n5                            14         Blood     5\n6                            30         Blood     6\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(ab_titer)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  specimen_id isotype is_antigen_specific antigen        MFI MFI_normalised\n1           1     IgE               FALSE   Total 1110.21154       2.493425\n2           1     IgE               FALSE   Total 2708.91616       2.493425\n3           1     IgG                TRUE      PT   68.56614       3.736992\n4           1     IgG                TRUE     PRN  332.12718       2.602350\n5           1     IgG                TRUE     FHA 1887.12263      34.050956\n6           1     IgE                TRUE     ACT    0.10000       1.000000\n   unit lower_limit_of_detection\n1 UG/ML                 2.096133\n2 IU/ML                29.170000\n3 IU/ML                 0.530000\n4 IU/ML                 6.205949\n5 IU/ML                 4.679535\n6 IU/ML                 2.816431\n```\n\n\n:::\n:::\n\n\n\n\nWe want to join `subject` and `specimen` together!\nUsing dplyer, there are two modes of joining-- innerjoining or full joining. Inerjoining only merges data frame values for which there are no values missing from either dataset.\n\nFor this, we only want those who both were vaccinated and also had their titers recorded, so we will use innerjoining.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n```{.r .cell-code}\nmeta <- inner_join(subject, specimen)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nJoining with `by = join_by(subject_id)`\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(meta)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  subject_id infancy_vac biological_sex              ethnicity  race\n1          1          wP         Female Not Hispanic or Latino White\n2          1          wP         Female Not Hispanic or Latino White\n3          1          wP         Female Not Hispanic or Latino White\n4          1          wP         Female Not Hispanic or Latino White\n5          1          wP         Female Not Hispanic or Latino White\n6          1          wP         Female Not Hispanic or Latino White\n  year_of_birth date_of_boost      dataset specimen_id\n1    1986-01-01    2016-09-12 2020_dataset           1\n2    1986-01-01    2016-09-12 2020_dataset           2\n3    1986-01-01    2016-09-12 2020_dataset           3\n4    1986-01-01    2016-09-12 2020_dataset           4\n5    1986-01-01    2016-09-12 2020_dataset           5\n6    1986-01-01    2016-09-12 2020_dataset           6\n  actual_day_relative_to_boost planned_day_relative_to_boost specimen_type\n1                           -3                             0         Blood\n2                            1                             1         Blood\n3                            3                             3         Blood\n4                            7                             7         Blood\n5                           11                            14         Blood\n6                           32                            30         Blood\n  visit\n1     1\n2     2\n3     3\n4     4\n5     5\n6     6\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nabdata <- inner_join(ab_titer, meta)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nJoining with `by = join_by(specimen_id)`\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(abdata)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  specimen_id isotype is_antigen_specific antigen        MFI MFI_normalised\n1           1     IgE               FALSE   Total 1110.21154       2.493425\n2           1     IgE               FALSE   Total 2708.91616       2.493425\n3           1     IgG                TRUE      PT   68.56614       3.736992\n4           1     IgG                TRUE     PRN  332.12718       2.602350\n5           1     IgG                TRUE     FHA 1887.12263      34.050956\n6           1     IgE                TRUE     ACT    0.10000       1.000000\n   unit lower_limit_of_detection subject_id infancy_vac biological_sex\n1 UG/ML                 2.096133          1          wP         Female\n2 IU/ML                29.170000          1          wP         Female\n3 IU/ML                 0.530000          1          wP         Female\n4 IU/ML                 6.205949          1          wP         Female\n5 IU/ML                 4.679535          1          wP         Female\n6 IU/ML                 2.816431          1          wP         Female\n               ethnicity  race year_of_birth date_of_boost      dataset\n1 Not Hispanic or Latino White    1986-01-01    2016-09-12 2020_dataset\n2 Not Hispanic or Latino White    1986-01-01    2016-09-12 2020_dataset\n3 Not Hispanic or Latino White    1986-01-01    2016-09-12 2020_dataset\n4 Not Hispanic or Latino White    1986-01-01    2016-09-12 2020_dataset\n5 Not Hispanic or Latino White    1986-01-01    2016-09-12 2020_dataset\n6 Not Hispanic or Latino White    1986-01-01    2016-09-12 2020_dataset\n  actual_day_relative_to_boost planned_day_relative_to_boost specimen_type\n1                           -3                             0         Blood\n2                           -3                             0         Blood\n3                           -3                             0         Blood\n4                           -3                             0         Blood\n5                           -3                             0         Blood\n6                           -3                             0         Blood\n  visit\n1     1\n2     1\n3     1\n4     1\n5     1\n6     1\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnrow(abdata)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 52576\n```\n\n\n:::\n:::\n\n\n\nwow !\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(abdata)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  specimen_id isotype is_antigen_specific antigen        MFI MFI_normalised\n1           1     IgE               FALSE   Total 1110.21154       2.493425\n2           1     IgE               FALSE   Total 2708.91616       2.493425\n3           1     IgG                TRUE      PT   68.56614       3.736992\n4           1     IgG                TRUE     PRN  332.12718       2.602350\n5           1     IgG                TRUE     FHA 1887.12263      34.050956\n6           1     IgE                TRUE     ACT    0.10000       1.000000\n   unit lower_limit_of_detection subject_id infancy_vac biological_sex\n1 UG/ML                 2.096133          1          wP         Female\n2 IU/ML                29.170000          1          wP         Female\n3 IU/ML                 0.530000          1          wP         Female\n4 IU/ML                 6.205949          1          wP         Female\n5 IU/ML                 4.679535          1          wP         Female\n6 IU/ML                 2.816431          1          wP         Female\n               ethnicity  race year_of_birth date_of_boost      dataset\n1 Not Hispanic or Latino White    1986-01-01    2016-09-12 2020_dataset\n2 Not Hispanic or Latino White    1986-01-01    2016-09-12 2020_dataset\n3 Not Hispanic or Latino White    1986-01-01    2016-09-12 2020_dataset\n4 Not Hispanic or Latino White    1986-01-01    2016-09-12 2020_dataset\n5 Not Hispanic or Latino White    1986-01-01    2016-09-12 2020_dataset\n6 Not Hispanic or Latino White    1986-01-01    2016-09-12 2020_dataset\n  actual_day_relative_to_boost planned_day_relative_to_boost specimen_type\n1                           -3                             0         Blood\n2                           -3                             0         Blood\n3                           -3                             0         Blood\n4                           -3                             0         Blood\n5                           -3                             0         Blood\n6                           -3                             0         Blood\n  visit\n1     1\n2     1\n3     1\n4     1\n5     1\n6     1\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(abdata$isotype)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n  IgE   IgG  IgG1  IgG2  IgG3  IgG4 \n 6698  5389 10117 10124 10124 10124 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(abdata$antigen)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n    ACT   BETV1      DT   FELD1     FHA  FIM2/3   LOLP1     LOS Measles     OVA \n   1970    1970    4978    1970    5372    4978    1970    1970    1970    4978 \n    PD1     PRN      PT     PTM   Total      TT \n   1970    5372    5372    1970     788    4978 \n```\n\n\n:::\n:::\n\n\n\nLet's look at IgG\n\n\n",
    "supporting": [
      "JCW_112024_Pertussis_Class15_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}